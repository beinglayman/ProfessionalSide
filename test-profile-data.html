<!DOCTYPE html>
<html>
<head>
    <title>Test Profile Data Injection</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 10px; padding: 10px 20px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>Test Profile Data Injection</h1>
    
    <div>
        <h3>Inject Test Data</h3>
        <button onclick="injectLocalStorageData()">Inject LocalStorage Data</button>
        <button onclick="injectAPIData()">Inject API Data</button>
        <button onclick="clearAllData()">Clear All Data</button>
        <button onclick="checkCurrentData()">Check Current Data</button>
        <button onclick="openProfile()">Open Profile Page</button>
    </div>
    
    <div id="result" class="result"></div>

    <script>
        const API_BASE_URL = 'http://localhost:3001/api/v1';

        function injectLocalStorageData() {
            const testData = {
                fullName: 'John Doe Test',
                currentTitle: 'Senior Developer',
                currentCompany: 'Test Corp',
                industry: 'Technology',
                yearsOfExperience: 8,
                location: 'San Francisco, CA',
                profileImageUrl: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop',
                professionalSummary: 'Experienced developer with expertise in modern web technologies.',
                specializations: ['Frontend Development', 'React.js', 'TypeScript'],
                careerHighlights: 'Led development of multiple successful projects.',
                skills: [
                    { name: 'React.js', proficiency: 'expert', category: 'Frontend' },
                    { name: 'TypeScript', proficiency: 'advanced', category: 'Languages' },
                    { name: 'Node.js', proficiency: 'intermediate', category: 'Backend' }
                ],
                topSkills: ['React.js', 'TypeScript', 'Node.js'],
                workExperiences: [{
                    id: '1',
                    title: 'Senior Developer',
                    company: 'Test Corp',
                    location: 'San Francisco, CA',
                    startDate: '2022-01',
                    endDate: '',
                    isCurrentRole: true,
                    description: 'Leading frontend development initiatives.',
                    achievements: ['Improved app performance by 40%', 'Led team of 5 developers'],
                    skills: ['React.js', 'TypeScript']
                }],
                education: [{
                    id: '1',
                    institution: 'University of Technology',
                    degree: 'Bachelor\'s Degree',
                    fieldOfStudy: 'Computer Science',
                    location: 'San Francisco, CA',
                    startYear: '2014',
                    endYear: '2018',
                    isCurrentlyStudying: false,
                    grade: '3.8/4.0',
                    description: 'Focused on software engineering',
                    activities: ['Programming Club', 'Hackathons']
                }],
                certifications: [],
                careerGoals: ['Become a Tech Lead', 'Start a Startup'],
                professionalInterests: ['AI & Machine Learning', 'Cloud Computing']
            };

            // Save to multiple localStorage keys for compatibility
            localStorage.setItem('onboarding_data', JSON.stringify(testData));
            localStorage.setItem('mock_onboarding_demo_user', JSON.stringify(testData));
            
            const userId = localStorage.getItem('user_id') || 'demo_user';
            localStorage.setItem(`mock_onboarding_${userId}`, JSON.stringify(testData));
            
            // Mark as complete
            localStorage.setItem('onboarding_complete', 'true');
            localStorage.setItem('onboarding_current_step', '7');

            document.getElementById('result').innerHTML = '✅ Test data injected into localStorage';
            
            // Dispatch events to notify profile view
            window.dispatchEvent(new CustomEvent('onboardingDataChanged', {
                detail: { source: 'test-injection', data: testData }
            }));
            
            window.dispatchEvent(new CustomEvent('profileUpdated', {
                detail: { source: 'test-injection' }
            }));
        }

        async function injectAPIData() {
            const token = localStorage.getItem('inchronicle_access_token');
            
            if (!token) {
                document.getElementById('result').innerHTML = '❌ No auth token found. Please log in first.';
                return;
            }

            const testData = {
                name: 'Jane Doe API Test',
                title: 'Senior Engineer',
                company: 'API Test Corp',
                location: 'New York, NY',
                industry: 'Technology',
                bio: 'Senior engineer with extensive experience in full-stack development.',
                onboardingData: {
                    fullName: 'Jane Doe API Test',
                    currentTitle: 'Senior Engineer',
                    currentCompany: 'API Test Corp',
                    industry: 'Technology',
                    yearsOfExperience: 10,
                    location: 'New York, NY',
                    profileImageUrl: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&h=400&fit=crop',
                    professionalSummary: 'Senior engineer with extensive experience in full-stack development.',
                    specializations: ['Full-Stack Development', 'API Design', 'Cloud Architecture'],
                    careerHighlights: 'Built scalable systems serving millions of users.',
                    skills: [
                        { name: 'Python', proficiency: 'expert', category: 'Languages' },
                        { name: 'AWS', proficiency: 'advanced', category: 'Cloud' },
                        { name: 'Docker', proficiency: 'intermediate', category: 'DevOps' }
                    ],
                    topSkills: ['Python', 'AWS', 'Docker'],
                    workExperiences: [],
                    education: [],
                    certifications: [],
                    careerGoals: ['Become a Solutions Architect'],
                    professionalInterests: ['Cloud Computing', 'DevOps']
                }
            };

            try {
                const response = await fetch(`${API_BASE_URL}/users/profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(testData)
                });

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('result').innerHTML = `✅ API data injected successfully: ${JSON.stringify(result, null, 2)}`;
                    
                    // Dispatch events
                    window.dispatchEvent(new CustomEvent('profileUpdated', {
                        detail: { source: 'api-injection' }
                    }));
                } else {
                    const errorText = await response.text();
                    document.getElementById('result').innerHTML = `❌ API injection failed (${response.status}): ${errorText}`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `❌ API injection error: ${error.message}`;
            }
        }

        function clearAllData() {
            // Clear localStorage
            const keysToRemove = [
                'onboarding_data',
                'mock_onboarding_demo_user',
                'onboarding_complete',
                'onboarding_current_step'
            ];
            
            const userId = localStorage.getItem('user_id') || 'demo_user';
            keysToRemove.push(`mock_onboarding_${userId}`);
            
            keysToRemove.forEach(key => localStorage.removeItem(key));
            
            document.getElementById('result').innerHTML = '✅ All test data cleared';
            
            // Dispatch update event
            window.dispatchEvent(new CustomEvent('profileUpdated', {
                detail: { source: 'data-cleared' }
            }));
        }

        function checkCurrentData() {
            const keys = [
                'onboarding_data',
                'mock_onboarding_demo_user',
                'onboarding_complete',
                'onboarding_current_step',
                'user_id',
                'inchronicle_access_token'
            ];
            
            let html = '<strong>Current Data:</strong><br>';
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    const truncated = value.length > 100 ? value.substring(0, 100) + '...' : value;
                    html += `✅ ${key}: ${truncated}<br>`;
                } else {
                    html += `❌ ${key}: not found<br>`;
                }
            });
            
            document.getElementById('result').innerHTML = html;
        }

        function openProfile() {
            window.open('http://localhost:5173/profile', '_blank');
        }

        // Auto-check current data on load
        window.onload = function() {
            checkCurrentData();
        };
    </script>
</body>
</html>